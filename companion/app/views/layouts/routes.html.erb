<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title><%= @route.user.phone_number %></title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
		// This example creates a 2-pixel-wide red polyline showing
		// the path of William Kingsford Smith's first trans-Pacific flight between
		// Oakland, CA, and Brisbane, Australia.

		function initialize() {
		  var mapOptions = {
		    zoom: 15,
		    center: new google.maps.LatLng(<%= @route.latitude_start %>,<%= @route.longitude_start %>),
		    mapTypeId: google.maps.MapTypeId.ROADMAP
		  };

		  var map = new google.maps.Map(document.getElementById('map-canvas'),
		      mapOptions);

		  var flightPlanCoordinates = [
		  	<% @route.route_steps.each do |route_step| %>
		    new google.maps.LatLng(<%= route_step.latitude %>, <%= route_step.longitude %>),
			<% end %>
		  ];
		  var flightPath = new google.maps.Polyline({
		    path: flightPlanCoordinates,
		    geodesic: true,
		    strokeColor: '#FF0000',
		    strokeOpacity: 1.0,
		    strokeWeight: 2
		  });

		  flightPath.setMap(map);
		  
		  // Draw starting location
		  var startLatLon = new google.maps.LatLng(<%= @route.route_steps[0].latitude %>,<%= @route.route_steps[0].longitude %>);
		  var marker = new google.maps.Marker({
		        position: startLatLon,
		        map: map,
		        title: '<%= @route.user.name %>\'s starting location'
		    });
		  
		  // Draw ending location
		  var endLatLon = new google.maps.LatLng(<%= @route.route_steps[@route.route_steps.count-1].latitude %>,<%= @route.route_steps[@route.route_steps.count-1].longitude %>);
		  var marker = new google.maps.Marker({
		        position: endLatLon,
		        map: map,
		        title: '<%= @route.user.name %>'
		    });
		}

		// google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>	
    <div id="map-canvas"></div>
	<%= yield %>
  </body>
</html>